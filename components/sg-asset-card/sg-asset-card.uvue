<template>
	<view class="sg-asset-card">
		<view class="sg-asset-card__header">
			<text class="sg-asset-card__label">{{ label }}</text>
			<view v-if="showEye" class="sg-asset-card__eye" @click="toggleVisible">
				<text class="sg-asset-card__eye-icon">{{ isVisible ? 'ğŸ‘' : 'ğŸ‘â€ğŸ—¨' }}</text>
			</view>
		</view>
		<view class="sg-asset-card__amount">
			<text class="sg-asset-card__currency">Â¥</text>
			<text class="sg-asset-card__value">{{ displayAmount }}</text>
		</view>
		<view v-if="showEarnings" class="sg-asset-card__earnings">
			<text class="sg-asset-card__earnings-label">{{ earningsLabel }}</text>
			<text 
				class="sg-asset-card__earnings-value"
				:class="earningsClass"
			>{{ displayEarnings }}</text>
		</view>
		<slot></slot>
	</view>
</template>

<script lang="uts">
	/**
	 * sg-asset-card èµ„äº§å¡ç‰‡ç»„ä»¶
	 * @description ç”¨äºå±•ç¤ºèµ„äº§é‡‘é¢çš„å¡ç‰‡ç»„ä»¶
	 * @property {String} label - æ ‡ç­¾æ–‡å­—
	 * @property {Number} amount - é‡‘é¢
	 * @property {Boolean} showEye - æ˜¯å¦æ˜¾ç¤ºéšè—æŒ‰é’®
	 * @property {Boolean} showEarnings - æ˜¯å¦æ˜¾ç¤ºæ”¶ç›Š
	 * @property {String} earningsLabel - æ”¶ç›Šæ ‡ç­¾
	 * @property {Number} earnings - æ”¶ç›Šé‡‘é¢
	 * @property {Number} earningsRate - æ”¶ç›Šç‡
	 */
	export default {
		name: 'sg-asset-card',
		props: {
			label: {
				type: String,
				default: 'æ€»èµ„äº§'
			},
			amount: {
				type: Number,
				default: 0
			},
			showEye: {
				type: Boolean,
				default: true
			},
			showEarnings: {
				type: Boolean,
				default: true
			},
			earningsLabel: {
				type: String,
				default: 'æ˜¨æ—¥æ”¶ç›Š'
			},
			earnings: {
				type: Number,
				default: 0
			},
			earningsRate: {
				type: Number,
				default: 0
			}
		},
		data() {
			return {
				isVisible: true
			}
		},
		computed: {
			displayAmount(): string {
				if (!this.isVisible) {
					return '****'
				}
				return this.formatMoney(this.amount)
			},
			displayEarnings(): string {
				if (!this.isVisible) {
					return '****'
				}
				const prefix = this.earnings >= 0 ? '+' : ''
				const rate = this.earningsRate ? ` (${this.earningsRate.toFixed(2)}%)` : ''
				return prefix + this.formatMoney(this.earnings) + rate
			},
			earningsClass(): string {
				if (this.earnings > 0) return 'sg-asset-card__earnings-value--rise'
				if (this.earnings < 0) return 'sg-asset-card__earnings-value--fall'
				return ''
			}
		},
		methods: {
			toggleVisible() {
				this.isVisible = !this.isVisible
			},
			formatMoney(num: number): string {
				return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')
			}
		}
	}
</script>
