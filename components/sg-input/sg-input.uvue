<template>
	<view class="sg-input" :class="{ 'sg-input--error': error, 'sg-input--disabled': disabled }">
		<view v-if="label" class="sg-input__label">
			<text class="sg-input__label-text">{{ label }}</text>
			<text v-if="required" class="sg-input__required">*</text>
		</view>
		<view class="sg-input__wrapper">
			<view v-if="prefixIcon" class="sg-input__prefix">
				<text class="sg-input__icon">{{ prefixIcon }}</text>
			</view>
			<input
				class="sg-input__inner"
				:type="inputType"
				:value="modelValue"
				:placeholder="placeholder"
				:maxlength="maxlength"
				:disabled="disabled"
				:password="type === 'password' && !showPassword"
				@input="handleInput"
				@focus="handleFocus"
				@blur="handleBlur"
			/>
			<view v-if="clearable && modelValue" class="sg-input__clear" @click="handleClear">
				<text class="sg-input__clear-icon">Ã—</text>
			</view>
			<view v-if="type === 'password'" class="sg-input__eye" @click="togglePassword">
				<text class="sg-input__eye-icon">{{ showPassword ? 'ğŸ‘' : 'ğŸ‘â€ğŸ—¨' }}</text>
			</view>
			<view v-if="suffixIcon" class="sg-input__suffix">
				<text class="sg-input__icon">{{ suffixIcon }}</text>
			</view>
			<slot name="suffix"></slot>
		</view>
		<view v-if="error && errorMessage" class="sg-input__error">
			<text class="sg-input__error-text">{{ errorMessage }}</text>
		</view>
	</view>
</template>

<script lang="uts">
	/**
	 * sg-input è¾“å…¥æ¡†ç»„ä»¶
	 * @description é€šç”¨è¾“å…¥æ¡†ç»„ä»¶ï¼Œæ”¯æŒå¤šç§ç±»å‹å’ŒéªŒè¯
	 * @property {String} modelValue - è¾“å…¥å€¼ï¼ˆv-modelï¼‰
	 * @property {String} type - è¾“å…¥ç±»å‹ï¼štext / password / number / tel
	 * @property {String} label - æ ‡ç­¾æ–‡å­—
	 * @property {String} placeholder - å ä½æ–‡å­—
	 * @property {Boolean} required - æ˜¯å¦å¿…å¡«
	 * @property {Boolean} clearable - æ˜¯å¦å¯æ¸…ç©º
	 * @property {Boolean} disabled - æ˜¯å¦ç¦ç”¨
	 * @property {Boolean} error - æ˜¯å¦é”™è¯¯çŠ¶æ€
	 * @property {String} errorMessage - é”™è¯¯æç¤ºä¿¡æ¯
	 * @property {Number} maxlength - æœ€å¤§é•¿åº¦
	 * @property {String} prefixIcon - å‰ç¼€å›¾æ ‡
	 * @property {String} suffixIcon - åç¼€å›¾æ ‡
	 */
	export default {
		name: 'sg-input',
		props: {
			modelValue: {
				type: String,
				default: ''
			},
			type: {
				type: String,
				default: 'text'
			},
			label: {
				type: String,
				default: ''
			},
			placeholder: {
				type: String,
				default: 'è¯·è¾“å…¥'
			},
			required: {
				type: Boolean,
				default: false
			},
			clearable: {
				type: Boolean,
				default: true
			},
			disabled: {
				type: Boolean,
				default: false
			},
			error: {
				type: Boolean,
				default: false
			},
			errorMessage: {
				type: String,
				default: ''
			},
			maxlength: {
				type: Number,
				default: -1
			},
			prefixIcon: {
				type: String,
				default: ''
			},
			suffixIcon: {
				type: String,
				default: ''
			}
		},
		emits: ['update:modelValue', 'input', 'focus', 'blur', 'clear'],
		data() {
			return {
				showPassword: false
			}
		},
		computed: {
			inputType(): string {
				if (this.type === 'password') {
					return 'text'
				}
				return this.type
			}
		},
		methods: {
			handleInput(e: any) {
				const value = e.detail.value
				this.$emit('update:modelValue', value)
				this.$emit('input', value)
			},
			handleFocus(e: any) {
				this.$emit('focus', e)
			},
			handleBlur(e: any) {
				this.$emit('blur', e)
			},
			handleClear() {
				this.$emit('update:modelValue', '')
				this.$emit('clear')
			},
			togglePassword() {
				this.showPassword = !this.showPassword
			}
		}
	}
</script>
