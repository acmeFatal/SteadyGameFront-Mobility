<template>
	<view class="advisor-page">
		<sg-navbar title="æˆ‘çš„é¡¾é—®" />
		
		<view v-if="advisor" class="advisor-info">
			<view class="advisor-card">
				<image class="advisor-avatar" :src="advisor.avatar || '/static/default-avatar.png'" mode="aspectFill"></image>
				<view class="advisor-details">
					<text class="advisor-name">{{ advisor.realName }}</text>
					<text class="advisor-title">{{ advisor.title }}</text>
					<view class="advisor-rating">
						<text class="advisor-rating-star">â­</text>
						<text class="advisor-rating-value">{{ advisor.rating }}</text>
					</view>
				</view>
			</view>
			
			<view class="advisor-intro">
				<text class="advisor-intro-title">ä¸ªäººç®€ä»‹</text>
				<text class="advisor-intro-text">{{ advisor.introduction }}</text>
			</view>
			
			<view class="advisor-specialties">
				<text class="advisor-specialties-title">æ“…é•¿é¢†åŸŸ</text>
				<view class="advisor-tags">
					<view v-for="(item, index) in advisor.specialties" :key="index" class="advisor-tag">
						<text class="advisor-tag-text">{{ item }}</text>
					</view>
				</view>
			</view>
			
			<view class="advisor-stats">
				<view class="advisor-stat">
					<text class="advisor-stat-value">{{ advisor.serviceYears }}å¹´</text>
					<text class="advisor-stat-label">ä»ä¸šç»éªŒ</text>
				</view>
				<view class="advisor-stat">
					<text class="advisor-stat-value">{{ advisor.clientCount }}</text>
					<text class="advisor-stat-label">æœåŠ¡å®¢æˆ·</text>
				</view>
			</view>
			
			<view class="advisor-actions">
				<view class="advisor-btn advisor-btn--message" @click="goToMessage">
					<text class="advisor-btn-icon">ğŸ’¬</text>
					<text class="advisor-btn-text">å‘æ¶ˆæ¯</text>
				</view>
				<view class="advisor-btn advisor-btn--call" @click="makeCall">
					<text class="advisor-btn-icon">ğŸ“</text>
					<text class="advisor-btn-text">ç”µè¯å’¨è¯¢</text>
				</view>
				<view class="advisor-btn advisor-btn--appointment" @click="goToAppointment">
					<text class="advisor-btn-icon">ğŸ“…</text>
					<text class="advisor-btn-text">é¢„çº¦å’¨è¯¢</text>
				</view>
			</view>
			
			<view class="advisor-change" @click="changeAdvisor">
				<text class="advisor-change-text">æ›´æ¢é¡¾é—®</text>
			</view>
		</view>
		
		<view v-else class="advisor-empty">
			<view class="advisor-empty-icon">
				<text class="advisor-empty-icon-text">ğŸ‘¨â€ğŸ’¼</text>
			</view>
			<text class="advisor-empty-text">æ‚¨è¿˜æ²¡æœ‰ä¸“å±é¡¾é—®</text>
			<text class="advisor-empty-desc">é€‰æ‹©ä¸€ä½ä¸“å±é¡¾é—®ï¼Œè·å¾—ä¸“ä¸šçš„ç†è´¢å»ºè®®</text>
			<view class="advisor-empty-btn" @click="goToSelectAdvisor">
				<text class="advisor-empty-btn-text">é€‰æ‹©é¡¾é—®</text>
			</view>
		</view>
	</view>
</template>

<script lang="uts">
	import { get } from '@/utils/request.uts'
	
	interface Advisor {
		advisorId: number
		advisorName: string
		realName: string
		avatar: string
		phone: string
		email: string
		title: string
		introduction: string
		specialties: string[]
		serviceYears: number
		clientCount: number
		rating: number
		assignedAt: string
	}
	
	export default {
		data() {
			return {
				advisor: null as Advisor | null
			}
		},
		onLoad() {
			this.loadAdvisor()
		},
		methods: {
			async loadAdvisor() {
				try {
					const res = await get<Advisor>('/user/my-advisor')
					this.advisor = res.data
				} catch (e) {
					console.error('è·å–é¡¾é—®ä¿¡æ¯å¤±è´¥:', e)
				}
			},
			
			goToMessage() {
				uni.navigateTo({ url: '/pages/advisor-message/advisor-message' })
			},
			
			makeCall() {
				if (this.advisor?.phone) {
					uni.makePhoneCall({
						phoneNumber: this.advisor.phone
					})
				}
			},
			
			goToAppointment() {
				uni.navigateTo({ url: '/pages/advisor-appointment/advisor-appointment' })
			},
			
			changeAdvisor() {
				uni.showModal({
					title: 'æ›´æ¢é¡¾é—®',
					content: 'ç¡®å®šè¦ç”³è¯·æ›´æ¢é¡¾é—®å—ï¼Ÿ',
					success: (res) => {
						if (res.confirm) {
							this.goToSelectAdvisor()
						}
					}
				})
			},
			
			goToSelectAdvisor() {
				uni.navigateTo({ url: '/pages/select-advisor/select-advisor' })
			}
		}
	}
</script>
